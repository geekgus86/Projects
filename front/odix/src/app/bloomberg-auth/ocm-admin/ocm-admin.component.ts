import { Component, OnInit } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { OcmServiceService } from './ocm-service.service';
import { ActivatedRoute } from '@angular/router';
// import { cellButton } from "";


@Component({
  selector: 'app-ocm-admin',
  templateUrl: './ocm-admin.component.html',
  styleUrls: ['./ocm-admin.component.scss']
})

export class OcmAdminComponent implements OnInit {

  columnGrids: any;
  rowData: any;
  dataGetAllByUEN:any;

  dataSettings= new Array();
  allField= new Array();
  idField= new Array();
  

  
  dataOCC= new Array();
  dataUEN= new Array();
  dataVC = new Array();
  dataVL = new Array();

  idUEN:string;
  result:any;


  Action:string;
  ID:number;
  UEN:string;
  Proceso:string;
  Linea:string;
  Grupo:string;
  EQE:string;
  Enn:string;
  Description:string;
  CC:string;


  constructor( private route: ActivatedRoute,private ocmService: OcmServiceService) {
    console.log("=============== OCM COMPONENT =============");
    //this.getspx("VL");
    
    this.loadData(this.route.snapshot.data.ocm.Table);
    this.columnGrid();
    this.settings();
  }
  
  ngOnInit() { 

    

  }

  settings(){
    /*ALL Fiel*/
    this.allField.push("PROCESO");
    this.allField.push("LINEA");
    this.allField.push("GRUPO");
    this.allField.push("EQE");
    this.allField.push("ENN");
    this.dataSettings.push(this.allField);
    /*Fiel editing */
    this.idField.push();
    this.dataSettings.push(this.idField);
    /*Setting Button */
    var displayBtnNew = "block"
    this.dataSettings.push(displayBtnNew);
}


  columnGrid()
  {
    this.columnGrids = [
      {headerName: 'UEN',colId:"idUEN", field: 'UEN',filter: "agTextColumnFilter",
      // cellEditor: "agSelectCellEditor", 
      cellEditor: 'select',
      editable: true,  
      cellEditorParams: { values:  this.dataUEN },
      onCellValueChanged(params:any) {
        var colId = params.column.getId();
        if (colId === "idUEN") {
          var selectedCountry = params.data.UEN;
          var selectedCity = params.data.CC;
          var allowedCities = countyToCityMap(selectedCountry);
          var cityMismatch = allowedCities.indexOf(selectedCity) < 0;
          if (cityMismatch) {
            params.node.setDataValue("CC", null);
          }
        }
      }
      },
      {headerName: 'PROCESO', field: 'PROCESO',filter: "agTextColumnFilter", editable: true},
      {headerName: 'LINEA', field: 'LINEA',filter: "agTextColumnFilter", editable: true},
      {headerName: 'GRUPO', field: 'GRUPO',filter: "agTextColumnFilter", editable: true},
      {headerName: 'EQE', field: 'EQE',filter: "agTextColumnFilter", editable: true},
      {headerName: 'ENN', field: 'ENN',filter: "agTextColumnFilter", editable: true},
      {headerName: 'DESCRIPCION', field: 'DESCRIPCION',filter: "agTextColumnFilter", editable: true},
      {headerName: 'CC',colId:"CC", field: 'CC',filter: "agTextColumnFilter",cellEditor: "agSelectCellEditor", editable: true,  cellEditorParams: function(params : any) {
        var selectedCountry = params.data.UEN;
        var allowedCities = countyToCityMap(selectedCountry);
        return {
          values: allowedCities,
          formatValue: function(value : any) {
            return value + " (" + selectedCountry + ")";
          }
        };
      }  },
      {headerName: "Action",field: "value",cellRenderer: "cellButton", colId: "params",suppressFilter: true,suppressSorting:true,width: 200,cellStyle: { backgroundColor: '#0f1019' } }
    ];
  }


  loadData(datos : any) {
    this.rowData = datos;
    this.dataUEN.push("VC");
    this.dataUEN.push("VL");
  }

  getspx(UEN:string){
    this.ocmService.spx(UEN) 
    .subscribe(res => {
      console.log("***** load data GetAllByUEN *****");
      this.dataGetAllByUEN =res;
      console.log(this.dataGetAllByUEN);
      this.dataGetAllByUEN.forEach((element: any) => {
        
        if(element.id_uen == 87)
        {
          this.dataVL.push(element.codigo);
        }else if(element.id_uen == 88){
          this.dataVC.push(element.codigo);
        }
          this.dataOCC.push(element.codigo);
      });
    });
  }

  
 eventapp(params:any){
  this.Action = params.Action
  this.ID=params.data.ID;
  this.UEN=params.data.UEN;
  this.Proceso=params.data.PROCESO;
  this.Linea=params.data.LINEA;
  this.Grupo=params.data.GRUPO;
  this.EQE=params.data.EQE;
  this.Enn=params.data.ENN;
  this.Description=params.data.DESCRIPCION;
  this.CC=params.data.CC;

  console.log("     /*Execute "+this.Action+"*/       ");
  this.postData();

}

  postData(){
    this.result= new Array();
    this.ocmService.editData(this.Action,this.ID,this.UEN,this.Proceso,this.Linea,this.Grupo,this.EQE,this.Enn,this.Description,this.CC) 
    .subscribe(res => {
      var object = new Object();
      object['type'] = res.Type;
      object['msj'] = res.Msj;
      object['error'] = res.Error;
      object['id'] = res.Id;
      object['last_update'] = res.Last_update;
      object['SuccessFlag'] = res.SuccessFlag;
      object['email'] = "";
      this.result = object
      alert(res.Msj)
    });

  }
}

function countyToCityMap(match : any) {
  var map = {
    VL: [ "00000"
    , "E0001"
    , "E0002"
    , "E0003"
    , "E0004"
    , "E0503"
    , "EC002"
    , "EC003"
    , "EL001"
    , "EM002"
    ,"EM003"
    ,"EM009"
    ,"EM011"
    ,"EM012"
    ,"EM013"
    ,"EM014"
    ,"EM015"
    ,"EM016"
    ,"EM017"
    ,"EM018"
    ,"EM019"
    ,"EM046"
    ,"EM047"
    ,"EM048"
    ,"EM049"
    ,"EM051"
    ,"EM052"
    ,"EM053"
    ,"EM056"
    ,"EM065"
    ,"EM102"
    ,"EO001"
    ,"EO002"
    ,"EO003"
    ,"EO004"
    ,"EO005"
    ,"EO006"
    ,"EO007"
    ,"EO008"
    ,"EO009"
    ,"EO011"
    ,"EO012"
    ,"EO013"
    ,"EO014"
    ,"EO016"
    ,"EO017"
    ,"EO018"
    ,"EO019"
    ,"EO021"
    ,"EO022"
    ,"EO023"
    ,"EO024"
    ,"EO025"
    ,"EO026"
    ,"EO028"
    ,"EO029"
    ,"EO031"
    ,"EO032"
    ,"EO035"
    ,"EO037"
    ,"EO038"
    ,"EO039"
    ,"EO101"
    ,"EO103"
    ,"EO104"
    ,"EO105"
    ,"EO107"
    ,"EO108"
    ,"EO109"
    ,"EO111"
    ,"EO112"
    ,"EO206"
    ,"EO207"
    ,"EO301"
    ,"H0001"
    ,"H0002"
    ,"HC001"
    ,"HC002"
    ,"HC003"
    ,"HL001"
    ,"HL002"
    ,"HL004"
    ,"HL005"
    ,"HM001"
    ,"HM002"
    ,"HM003"
    ,"HM004"
    ,"HM005"
    ,"HM035"
    ,"HM036"
    ,"HM037"
    ,"HM038"
    ,"HM039"
    ,"HM041"
    ,"HM042"
    ,"HM043"
    ,"HM045"
    ,"HM046"
    ,"HO001"
    ,"HO002"
    , "HO003"
    , "HO004"
    , "HO005"
    , "HO006"
    , "HO007"
    , "HO008"
    , "HO009"
    , "HO036"
    , "I0001"
    , "I0002"
    , "I0003"
    , "I0004"
    , "I0005"
    , "IC001"
    , "IC002"
    , "IC003"
    , "IC004"
    , "IC005"
    , "IM001"
    , "IM002"
    , "IM003"
    , "IM004"
    , "IM005"
    , "IM006"
    , "IM009"
    , "IM016"
    , "IO001"
    , "IO002"
    , "IO003"
    , "IO004"
    , "IO005"
    , "IO006"
    , "IO007"
    , "IO008"
    , "IO009"
    , "IO011"
    , "IO012"
    , "IO013"
    , "IO015"
    , "IO021"
    , "IO023"
    , "IO561"
    , "M0001"
    , "M0002"
    , "ML003"
    , "MM001"
    , "MM002"
    , "MM003"
    , "MM004"
    , "MO001"
    , "MO002"
    , "MO003"
    , "MO004"
    , "N0001"
    , "N0012"
    , "N0013"
    , "N0017"
    , "N0019"
    , "N0021"
    , "N0022"
    , "N0023"
    , "N0024"
    , "N0025"
    , "N0028"
    , "N0031"
    , "N0032"
    , "N0037"
    , "N0038"
    , "NC001"
    , "NC002"
    , "NC003"
    , "NC004"
    , "NC005"
    , "NC006"
    , "NC007"
    , "NC008"
    , "NC013"
    , "NC014"
    , "NC017"
    , "NC018"
    , "NC019"
    , "NC021"
    , "NC022"
    , "NC023"
    , "NC024"
    , "NC025"
    , "NC026"
    , "NC027"
    , "NC028"
    , "NC029"
    , "NC031"
    , "NC037"
    , "NC038"
    , "NC039"
    , "NC042"
    , "NC045"
    , "NC046"
    , "NC048"
    , "NC049"
    , "NC055"
    , "NC056"
    , "NC057"
    , "NC058"
    , "NC059"
    , "NC061"
    , "NC062"
    , "NL001"
    , "NL002"
    , "NL003"
    , "NL004"
    , "NL005"
    , "NL006"
    , "NL008"
    , "NL009"
    , "NL010"
    , "NL012"
    , "NL015"
    , "NL016"
    , "NL017"
    , "NL018"
    , "NL019"
    , "NL022"
    , "NL023"
    , "NL024"
    , "NL026"
    , "NL027"
    , "NL035"
    , "NL043"
    , "NL044"
    , "NM001"
    , "NM002"
    , "NM003"
    , "NM004"
    , "NM005"
    , "NM006"
    , "NM007"
    , "NM008"
    , "NM014"
    , "NM015"
    , "NM021"
    , "NM022"
    , "NM023"
    , "NM024"
    , "NM026"
    , "NM028"
    , "NM029"
    , "NM031"
    , "NM032"
    , "NM033"
    , "NM034"
    , "NM035"
    , "NM036"
    , "NM037"
    , "NM038"
    , "NM039"
    , "NM041"
    , "NM044"
    , "NM045"
    , "NM046"
    , "NM047"
    , "NM048"
    , "NM049"
    , "NM051"
    , "NM052"
    , "NM053"
    , "NM054"
    , "NM059"
    , "NM061"
    , "NM065"
    , "NM066"
    , "NM067"
    , "NM068"
    , "NM071"
    , "NM072"
    , "NM073"
    , "NM074"
    , "NM079"
    , "NM081"
    , "NM082"
    , "NM083"
    , "NM084"
    , "NM086"
    , "NM087"
    , "NM091"
    , "NM092"
    , "NM093"
    , "NM097"
    , "NM116"
    , "NM117"
    , "NM119"
    , "NM121"
    , "NM122"
    , "NM123"
    , "NM124"
    , "NM125"
    , "NM126"
    , "NM127"
    , "NM128"
    , "NM129"
    , "NM131"
    , "NO001"
    , "NO002"
    , "NO003"
    , "NO004"
    , "NO005"
    , "NO006"
    , "NO007"
    , "NO008"
    , "NO009"
    , "NO011"
    , "NO013"
    , "NO014"
    , "NO017"
    , "NO018"
    , "NO019"
    , "NO021"
    , "NO022"
    , "NO025"
    , "NO028"
    , "NO029"
    , "NO030"
    , "NO031"
    , "NO037"
    , "NO038"
    , "NO039"
    , "NO041"
    , "NO042"
    , "NO043"
    , "NO044"
    , "NO045"
    , "NO046"
    , "NO047"
    , "NO048"
    , "NO049"
    , "NO051"
    , "NO052"
    , "NO053"
    , "NO054"
    , "NO055"
    , "NO056"
    , "NO057"
    , "NO058"
    , "NO059"
    , "NO061"
    , "NO062"
    , "NO063"
    , "NO064"
    , "NO065"
    , "NO066"
    , "NO067"
    , "NO068"
    , "NO069"
    , "NO071"
    , "NO072"
    , "NO073"
    , "NO074"
    , "NO075"
    , "NO076"
    , "NO077"
    , "NO078"
    , "NO079"
    , "NO081"
    , "NO083"
    , "NO084"
    , "NO085"
    , "NO086"
    , "NO087"
    , "NO088"
    , "NO089"
    , "NO091"
    , "NO092"
    , "NO093"
    , "NO094"
    , "NO095"
    , "NO098"
    , "NO099"
    , "NO101"
    , "NO102"
    , "NO103"
    , "NO104"
    , "NO105"
    , "NO106"
    , "NO107"
    , "NO108"
    , "NO109"
    , "NO112"
    , "NO113"
    , "NO114"
    , "NO115"
    , "NO116"
    , "NO117"
    , "NO121"
    , "NO122"
    , "NO123"
    , "NO124"
    , "NO126"
    , "NO127"
    , "NO128"
    , "NO129"
    , "NO131"
    , "NO132"
    , "NO133"
    , "NO134"
    , "NO136"
    , "NO137"
    , "NO138"
    , "NO139"
    , "NO141"
    , "NO142"
    , "NO143"
    , "NO144"
    , "NO145"
    , "NO146"
    , "NO147"
    , "NO148"
    , "NO149"
    , "NO151"
    , "NO152"
    , "NO153"
    , "NO161"
    , "NO162"
    , "NO163"
    , "NO164"
    , "NO166"
    , "NO167"
    , "NO168"
    , "NO169"
    , "NO173"
    , "NO174"
    , "NO175"
    , "NO176"
    , "NO177"
    , "NO178"
    , "NO179"
    , "NO181"
    , "NO182"
    , "NO183"
    , "NO184"
    , "NO185"
    , "NO186"
    , "NO187"
    , "NO188"
    , "NO189"
    , "NO191"
    , "NO192"
    , "NO193"
    , "NO194"
    , "NO195"
    , "NO196"
    , "NO197"
    , "NO198"
    , "NO227"
    , "NO247"
    , "NO248"
    , "NO249"
    , "NO251"
    , "NO252"
    , "NO253"
    , "NO254"
    , "NO255"
    , "NO262"
    , "NO263"
    , "NO264"
    , "NO265"
    , "NO266"
    , "NO267"
    , "NO268"
    , "NO269"
    , "NO271"
    , "NO272"
    , "NO273"
    , "NO274"
    , "NO275"
    , "NO276"
    , "NO277"
    , "NO278"
    , "NO279"
    , "NO281"
    , "NO282"
    , "NO283"
    , "NO284"
    , "NO285"
    , "NO286"
    , "NO287"
    , "NO288"
    , "NO289"
    , "NO291"
    , "NO292"
    , "NO293"
    , "NO294"
    , "NO295"
    , "NO296"
    , "NO332"
    , "NO336"
    , "PA003"
    , "PA004"
    , "PA005"
    , "PA006"
    , "PA025"
    , "PA026"
    , "PA101"
    , "PA102"
    , "PA103"
    , "PA209"
    , "PA211"
    , "PA213"
    , "PA301"
    , "PA312"
    , "PA401"
    , "PA402"
    , "PA403"
    , "PA404"
    , "PA405"
    , "PA406"
    , "PA407"
    , "PA411"
    , "PA412"
    , "PA419"
    , "PA421"
    , "PA426"
    , "PA434"
    , "PA501"
    , "PA502"
    , "PA506"
    , "PA601"
    , "PA602"
    , "PA901"
    , "PA902"
    , "PA904"
    , "PA905"
    , "PA942"
    , "PA943"
    , "PA944"
    , "PA946"
    , "PA975"
    , "PA978"
    , "PA984"
    , "PC002"
    , "PC003"
    , "PC004"
    , "PC005"
    , "PC008"
    , "PC011"
    , "PC012"
    , "PC017"
    , "PC021"
    , "PC022"
    , "PC023"
    , "PC902"
    , "PC904"
    , "PS001"
    , "PS002"
    , "PS007"
    , "PS008"
    , "PS011"
    , "PS012"
    , "PS013"
    , "PS014"
    , "PS015"
    , "PS016"
    , "PS018"
    , "PS022"
    , "PS023"
    , "PS024"
    , "PS025"
    , "PS026"
    , "PS027"
    , "PS028"
    , "PS033"
    , "PS034"
    , "PS035"
    , "PS036"
    , "PS037"
    , "PS038"
    , "PS039"
    , "PS041"
    , "PS042"
    , "PS043"
    , "PS044"
    , "PS046"
    , "PS047"
    , "PS048"
    , "PS049"
    , "PS051"
    , "PS052"
    , "PS053"
    , "PS054"
    , "PS055"
    , "PS056"
    , "PS057"
    , "PS067"
    , "PS068"
    , "PS074"
    , "PS075"
    , "PS076"
    , "PS082"
    , "PS083"
    , "PS087"
    , "PS093"
    , "PS096"
    , "PS097"
    , "PS098"
    , "PS099"
    , "PS101"
    , "PS102"
    , "PS103"
    , "PS104"
    , "PS105"
    , "PS107"
    , "PS109"
    , "PS111"
    , "PS115"
    , "PS116"
    , "PS119"
    , "PS121"
    , "PS122"
    , "PS123"
    , "PS124"
    , "PS127"
    , "PS209"
    , "PS901"
    , "PS902"
    , "PS903"
    , "PS904"
    , "R0001"
    , "R0002"
    , "R0003"
    , "R0004"
    , "XP901"],
    VC: ["00000"
    ,"E0002"
    ,"EM002"
    ,"EM003"
    ,"EM005"
    ,"EM006"
    ,"EM007"
    ,"EM008"
    ,"EM009"
    ,"EM054"
    ,"EM055"
    ,"EO101"
    ,"EO102"
    ,"EO103"
    ,"EO104"
    ,"EO105"
    ,"EO106"
    ,"EO107"
    ,"EO108"
    ,"EO109"
    ,"EO111"
    ,"EO112"
    ,"EO205"
    ,"IM001"
    ,"IM002"
    ,"IO004"
    ,"IO005"
    ,"MM001"
    ,"MO001"
    ,"MO002"
    ,"N0001"
    ,"PA003"
    ,"PA025"
    ,"PA103"
    ,"PA202"
    ,"PA209"
    ,"PA211"
    ,"PA301"
    ,"PA302"
    ,"PA401"
    ,"PA402"
    ,"PA403"
    ,"PA404"
    ,"PA405"
    ,"PA407"
    ,"PA421"
    ,"PA426"
    ,"PA428"
    ,"PA501"
    ,"PA502"
    ,"PA503"
    ,"PA504"
    ,"PA505"
    ,"PA601"
    ,"PA602"
    ,"PA704"
    ,"PA705"
    ,"PA901"
    ,"PA902"
    ,"PA903"
    ,"PA904"
    ,"PA905"
    ,"PC001"
    ,"PC003"
    ,"PC004"
    ,"PC005"
    ,"PC008"
    ,"PC011"
    ,"PC013"
    ,"PC014"
    ,"PC016"
    ,"PC018"
    ,"PC019"
    ,"PC021"
    ,"PC024"
    ,"PC026"
    ,"PC209"
    ,"PC904"
    ,"PS001"
    ,"PS002"
    ,"PS003"
    ,"PS004"
    ,"PS005"
    ,"PS007"
    ,"PS008"
    ,"PS009"
    ,"PS012"
    ,"PS013"
    ,"PS014"
    ,"PS015"
    ,"PS016"
    ,"PS017"
    ,"PS018"
    ,"PS019"
    ,"PS022"
    ,"PS023"
    ,"PS024"
    ,"PS025"
    ,"PS028"
    ,"PS031"
    , "PS033"
    , "PS074"
    , "PS075"
    , "PS076"
    , "PS077"
    , "PS078"
    , "PS079"
    , "PS081"
    , "PS082"
    , "PS083"
    , "PS084"
    , "PS093"
    , "PS094"
    , "PS104"
    , "PS109"
    , "PS111"
    , "PS118"
    , "PS209"
    , "PS902"
    , "PS903"
    , "PS904"
    , "R0004"
    , "T0001"
    , "TC001"
    , "TC002"
    , "TC003"
    , "TC004"
    , "TC005"
    , "TC006"
    , "TC007"
    , "TL001"
    , "TM001"
    , "TM002"
    , "TM003"
    , "TM004"
    , "TM009"
    , "TM011"
    , "TM012"
    , "TM013"
    , "TM014"
    , "TO001"
    , "TO002"
    , "TO003"
    , "TO004"
    , "TO005"
    , "TO006"
    , "TO007"
    , "TO011"
    , "TO012"
    , "TO013"
    , "XP901"]
  };
  return map[match];
}
